<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>åŒ—å°å›¾ä¹¦é¦† - 3Dé«˜æ–¯æ¨¡å‹å±•è§ˆ</title>
  <script type="text/javascript" src="js/util.js"></script>
  <script type="importmap">
    {
        "imports": {
            "three": "./lib/three.module.js",
            "@mkkellogg/gaussian-splats-3d": "./lib/gaussian-splats-3d.module.js"
        }
    }
  </script>
  <style>
    body {
      background-color: #000000;
      height: 100vh;
      margin: 0px;
      font-family: 'Microsoft YaHei', sans-serif;
      overflow: hidden;
    }

    /* é¡¶éƒ¨å¯¼èˆªæ  */
    .model-nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 97%;
      background: rgba(10, 10, 10, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 14px;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .btn-icon {
      font-size: 1.1rem;
    }

    .scene-title h2 {
      font-weight: 400;
      font-size: 1.5rem;
      color: white;
      margin: 0;
    }

    .nav-actions {
      display: flex;
      gap: 1rem;
    }

    /* åœºæ™¯åˆ‡æ¢èœå• */
    .scenes-menu {
      position: fixed;
      top: 80px;
      right: -400px;
      width: 300px;
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 1.5rem;
      transition: right 0.3s ease;
      z-index: 99;
    }

    .scenes-menu.active {
      right: 2rem;
    }

    .menu-content h3 {
      margin-bottom: 1rem;
      font-weight: 500;
      color: white;
    }

    .menu-scenes {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .menu-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 12px 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      text-align: left;
      width: 100%;
      font-size: 14px;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(-5px);
    }

    .menu-icon {
      font-size: 1.2rem;
    }

    /* ä¿¡æ¯é¢æ¿ */
    .info-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100%;
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      transition: right 0.3s ease;
      z-index: 98;
    }

    .info-panel.active {
      right: 0;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .panel-header h3 {
      color: white;
      margin: 0;
      font-weight: 500;
    }

    .close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .panel-content {
      padding: 1.5rem;
      color: white;
    }

    .panel-content h4 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      font-weight: 500;
    }

    .panel-content p {
      line-height: 1.6;
      opacity: 0.9;
      margin: 0;
    }

    /* æ“ä½œæç¤º */
    .control-tips {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 1rem 1.5rem;
      display: flex;
      gap: 2rem;
      z-index: 10;
    }

    .tip-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
    }

    .tip-key {
      background: rgba(255, 255, 255, 0.1);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8rem;
      min-width: 80px;
      text-align: center;
      color: white;
    }

    .tip-desc {
      font-size: 0.7rem;
      opacity: 0.7;
      color: white;
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.3s ease;
      color: white;
    }

    .loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid #4facfe;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .model-nav {
        padding: 1rem;
      }
      
      .nav-btn span:not(.btn-icon) {
        display: none;
      }
      
      .scenes-menu {
        width: calc(100% - 2rem);
        right: -100%;
      }
      
      .info-panel {
        width: 100%;
        right: -100%;
      }
      
      .control-tips {
        bottom: 1rem;
        padding: 0.8rem 1rem;
        gap: 1rem;
      }
      
      .tip-item {
        min-width: 60px;
      }
    }

    
  </style>
</head>

<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <nav class="model-nav">
    <button class="nav-btn back-btn" onclick="openDemo('index', [])">
      <span class="btn-icon">â†</span>
      è¿”å›é¦–é¡µ
    </button>
    
    <div class="scene-title">
      <h2 id="current-scene-title">åŒ—å°å›¾ä¹¦é¦†</h2>
    </div>

    <div class="nav-actions">
      <button class="nav-btn info-btn" onclick="toggleInfoPanel()">
        <span class="btn-icon">â„¹ï¸</span>
        åœºæ™¯ä¿¡æ¯
      </button>
      <button class="nav-btn scenes-btn" onclick="toggleScenesMenu()">
        <span class="btn-icon">ğŸ”</span>
        åˆ‡æ¢åœºæ™¯
      </button>
    </div>
  </nav>

  <!-- åœºæ™¯åˆ‡æ¢èœå• -->
  <div id="scenes-menu" class="scenes-menu">
    <div class="menu-content">
      <h3>é€‰æ‹©æ¢ç´¢åŒºåŸŸ</h3>
      <div class="menu-scenes">
        <button class="menu-item" onclick="openDemo('test', [['mode', '0']])">
          <span class="menu-icon">ğŸ›ï¸</span>
          å›¾ä¹¦é¦†å¤§å…
        </button>
        <button class="menu-item" onclick="openDemo('truck', [['mode', '1']])">
          <span class="menu-icon">ğŸ“š</span>
          é˜…è¯»åŒº
        </button>
        <button class="menu-item" onclick="openDemo('model', [['mode', '2']])">
          <span class="menu-icon">ğŸ’»</span>
          è‡ªä¹ åŒº
        </button>
      </div>
    </div>
  </div>

  <!-- ä¿¡æ¯é¢æ¿ -->
  <div id="info-panel" class="info-panel">
    <div class="panel-header">
      <h3>åœºæ™¯ä¿¡æ¯</h3>
      <button class="close-btn" onclick="toggleInfoPanel()">Ã—</button>
    </div>
    <div class="panel-content">
      <div id="scene-info-content">
        <h4 id="info-title">åŒ—å°å›¾ä¹¦é¦†</h4>
        <p id="info-description">è¿™é‡Œæ˜¯åŒ—å°å›¾ä¹¦é¦†çš„3Dé«˜æ–¯æ¨¡å‹å±•ç¤ºã€‚é‡‡ç”¨å…ˆè¿›çš„Gaussian SplattingæŠ€æœ¯ï¼ŒçœŸå®è¿˜åŸå›¾ä¹¦é¦†çš„å»ºç­‘ç©ºé—´å’Œç»†èŠ‚ã€‚</p>
      </div>
    </div>
  </div>

  <!-- æ“ä½œæç¤º -->
  <div class="control-tips">
    <div class="tip-item">
      <span class="tip-key">é¼ æ ‡æ‹–åŠ¨</span>
      <span class="tip-desc">æ—‹è½¬è§†è§’</span>
    </div>
    <div class="tip-item">
      <span class="tip-key">æ»šè½®</span>
      <span class="tip-desc">ç¼©æ”¾</span>
    </div>
    <div class="tip-item">
      <span class="tip-key">å³é”®æ‹–åŠ¨</span>
      <span class="tip-desc">å¹³ç§»</span>
    </div>
  </div>

  <!-- åŠ è½½çŠ¶æ€ -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <p>æ­£åœ¨åŠ è½½3Dåœºæ™¯...</p>
  </div>

  <script>
    // å¯¼èˆªå‡½æ•°
    function openDemo(page, params) {
      let url = page + '.html';
      if (params && params.length > 0) {
        let index = 0;
        for (let param of params) {
          url += (index === 0 ? "?" : "&");
          url += param[0] + "=" + param[1];
          index++;
        }
      }
      window.location = url;
    }

    // UIæ§åˆ¶å‡½æ•°
    function toggleInfoPanel() {
      const panel = document.getElementById('info-panel');
      panel.classList.toggle('active');
    }

    function toggleScenesMenu() {
      const menu = document.getElementById('scenes-menu');
      menu.classList.toggle('active');
    }

    // æ ¹æ®URLå‚æ•°æ›´æ–°åœºæ™¯ä¿¡æ¯
    function updateSceneInfo() {
      const urlParams = new URLSearchParams(window.location.search);
      const mode = parseInt(urlParams.get('mode')) || 0;
      
      const sceneConfig = {
        0: {
          title: 'å›¾ä¹¦é¦†å¤§å…',
          description: 'å®ä¼Ÿçš„å›¾ä¹¦é¦†å¤§å…ï¼Œå±•ç°äº†ç°ä»£å»ºç­‘ç¾å­¦ä¸å®ç”¨åŠŸèƒ½çš„å®Œç¾ç»“åˆã€‚è¿™é‡Œæ˜¯è¯»è€…è¿›å…¥çŸ¥è¯†ä¸–ç•Œçš„ç¬¬ä¸€ç«™ï¼Œå®½æ•çš„ç©ºé—´å’Œç²¾å¿ƒè®¾è®¡çš„å…‰çº¿è¥é€ å‡ºåº„é‡è€Œæ¸©é¦¨çš„æ°›å›´ã€‚'
        },
        1: {
          title: 'é˜…è¯»åŒº',
          description: 'å®‰é™èˆ’é€‚çš„é˜…è¯»åŒºåŸŸï¼Œé…å¤‡ä¸“ä¸šçš„é˜…è¯»ç¯å…‰å’Œç¬¦åˆäººä½“å·¥å­¦çš„åº§æ¤…ã€‚è¿™é‡Œæ˜¯æ·±åº¦é˜…è¯»å’Œæ€è€ƒçš„ç†æƒ³ç©ºé—´ï¼Œé˜³å…‰é€è¿‡çª—æˆ·æ´’åœ¨ä¹¦é¡µä¸Šï¼Œè¥é€ å‡ºå®é™çš„é˜…è¯»ä½“éªŒã€‚'
        },
        2: {
          title: 'è‡ªä¹ åŒº', 
          description: 'åŒ—å°å­¦å­å‹¤å¥‹å­¦ä¹ çš„æ ¸å¿ƒåŒºåŸŸã€‚æ•´é½æ’åˆ—çš„å­¦ä¹ æ¡Œæ¤…ã€å……è¶³çš„ç”µæºæ¥å£å’Œç¨³å®šçš„ç½‘ç»œç¯å¢ƒï¼Œä¸ºå­¦ç”Ÿä»¬æä¾›äº†é«˜æ•ˆçš„å­¦ä¹ ç©ºé—´ã€‚è¿™é‡Œè§è¯äº†æ— æ•°æ¢¦æƒ³çš„å­•è‚²å’Œå®ç°ã€‚'
        }
      };

      const config = sceneConfig[mode] || sceneConfig[0];
      document.getElementById('current-scene-title').textContent = config.title;
      document.getElementById('info-title').textContent = config.title;
      document.getElementById('info-description').textContent = config.description;
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading() {
      const overlay = document.getElementById('loading-overlay');
      overlay.classList.remove('hidden');
    }

    // éšè—åŠ è½½çŠ¶æ€
    function hideLoading() {
      const overlay = document.getElementById('loading-overlay');
      overlay.classList.add('hidden');
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      updateSceneInfo();
      showLoading();
    });

    // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•å’Œé¢æ¿
    document.addEventListener('click', function(event) {
      const scenesMenu = document.getElementById('scenes-menu');
      const infoPanel = document.getElementById('info-panel');
      
      if (scenesMenu.classList.contains('active') && 
          !event.target.closest('.scenes-menu') && 
          !event.target.closest('.scenes-btn')) {
        scenesMenu.classList.remove('active');
      }
    });
  </script>

  <script type="module">
    import * as GaussianSplats3D from '@mkkellogg/gaussian-splats-3d';
    import * as THREE from 'three';

    const urlParams = new URLSearchParams(window.location.search);
    const mode = parseInt(urlParams.get('mode')) || 0;

    // æ ¹æ®åœºæ™¯æ¨¡å¼è®¾ç½®ä¸åŒçš„ç›¸æœºå‚æ•°
    const sceneConfigs = {
      0: { // å›¾ä¹¦é¦†å¤§å…
        cameraUp: [0, -1, -0.54],
        initialCameraPosition: [-3.15634, -0.16946, -0.51552],
        initialCameraLookAt: [1.52976, 2.27776, 1.65898]
      },
      1: { // é˜…è¯»åŒº
        cameraUp: [0, -1, -0.54],
        initialCameraPosition: [-2.5, -0.5, -1.0],
        initialCameraLookAt: [1.0, 1.5, 1.0]
      },
      2: { // è‡ªä¹ åŒº
        cameraUp: [0, -1, -0.54],
        initialCameraPosition: [-2.0, -0.3, -1.5],
        initialCameraLookAt: [0.5, 1.0, 0.5]
      }
    };

    const config = sceneConfigs[mode] || sceneConfigs[0];

    const viewer = new GaussianSplats3D.Viewer({
      'cameraUp': config.cameraUp,
      'initialCameraPosition': config.initialCameraPosition,
      'initialCameraLookAt': config.initialCameraLookAt,
      'sphericalHarmonicsDegree': 2
    });

    // æ ¹æ®æ¨¡å¼åŠ è½½å¯¹åº”çš„æ¨¡å‹æ–‡ä»¶
    let path = 'assets/data/test/test' + (mode ? '_high' : '') + '.splat';
    
    viewer.addSplatScene(path, {
      'progressiveLoad': false
    })
    .then(() => {
        viewer.start();
        // æ¨¡å‹åŠ è½½å®Œæˆåéšè—åŠ è½½çŠ¶æ€
        setTimeout(() => {
            hideLoading();
        }, 1000);
    })
    .catch((error) => {
        console.error('æ¨¡å‹åŠ è½½å¤±è´¥:', error);
        hideLoading();
    });

  </script>
</body>

</html>